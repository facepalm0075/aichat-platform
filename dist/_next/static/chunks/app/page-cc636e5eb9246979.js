(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3999:function(e,s,t){Promise.resolve().then(t.bind(t,615))},615:function(e,s,t){"use strict";t.d(s,{default:function(){return m}});var r=t(7437),n=t(2265),a=t(6446),l=t(4633);t(895);var i=e=>{let{markdown:s}=e,t=(0,n.useRef)([]);return(0,n.useEffect)(()=>{},[s]),(0,r.jsx)("div",{className:"markdown-container flex-1",children:(0,r.jsx)(a.U,{remarkPlugins:[l.Z],components:{pre:e=>{let{node:s,children:n}=e;return(0,r.jsx)("pre",{ref:e=>t.current.push(e),children:n})}},children:s})})};let o=(e,s)=>{let t=null,r=!1,n=!1,a=null,l=()=>{n=!0,r=!1,a&&a.cancel()},i=e=>{e.forEach(e=>{s({message:e,error:t,isConnected:r},l)})};return(async()=>{try{var s;let t=await fetch("https://aichat-server.pouyaprogramming.ir/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({p:e})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));r=!0;let l=null===(s=t.body)||void 0===s?void 0:s.getReader();a=l;let o=new TextDecoder("utf-8");for(;;){let{done:e,value:s}=await l.read();if(e||n)break;let t=o.decode(s,{stream:!0}).split("||n||").filter(e=>""!==e.trim()).map(e=>{try{return JSON.parse(e)}catch(s){return console.error("Failed to parse JSON:",e),null}}).filter(e=>null!==e);i(t)}}catch(e){console.error("SSE fetch error:",e),t="Failed to connect to the SSE server.",r=!1}})(),{stoper:l}},c=null,u=(0,n.forwardRef)(function(e,s){let{input:t,click:a,callBack:l}=e,[u,d]=(0,n.useState)([]),[h,m]=(0,n.useState)(0),f=(0,n.useRef)(null),x=()=>{c&&(c(),c=null,l("ready"))},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:150,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=f.current;if(t){if(s){t.scrollTop=t.scrollHeight;return}t.scrollTop+t.offsetHeight+e>=t.scrollHeight&&(t.scrollTop=t.scrollHeight)}},g=(e,s)=>{203===e.message.status?(u[a]?u[a].answer+=e.message.message:u.push({question:t,answer:e.message.message,isText:!0}),d(e=>u),l("streaming")):200===e.message.status?l("ready"):500===e.message.status&&(u[a]?(u[a].answer=(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"bg-red-600 border p-2 rounded-md bg-opacity-30",children:"Queue is full! Please try later."})}),u[a].isText=!1):u.push({question:t,answer:e.message.message,isText:!1}),d(e=>u),l("ready")),m(e=>e+1),p()};return(0,n.useEffect)(()=>{d(e=>[...e,{question:t,answer:"Generating...",isText:!0}]);let e="";u.forEach(s=>{e+="user:"+s.question+"\nAssistant:"+s.answer+"\n\n"}),c=o(e+"user:".concat(t,"\nAssistant:"),g).stoper},[a]),(0,n.useEffect)(()=>{p(400,!0)},[u]),(0,n.useImperativeHandle)(s,()=>({stopStream:x})),(0,r.jsx)("div",{ref:f,className:"sh-container2",children:(0,r.jsxs)("div",{className:"sh-container",children:[u.map((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("span",{className:"py-3 px-5 bg-neutral-700 rounded-2xl my-7",children:e.question})}),(0,r.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,r.jsx)("div",{children:(0,r.jsx)("img",{alt:"ollama-image",src:"/ollama.png",className:"min-w-8 max-w-8 rounded-full",width:32,height:32})}),e.isText?(0,r.jsx)(i,{markdown:e.answer}):(0,r.jsx)(r.Fragment,{children:e.answer})]})]},s)),(0,r.jsx)("div",{style:{height:"100px"}})]})})});var d=t(5097),h=t(3872);function m(){let[e,s]=(0,n.useState)("hi"),[t,a]=(0,n.useState)(""),[l,i]=(0,n.useState)(0),[o,c]=(0,n.useState)("ready"),m=(0,n.useRef)(null),f=()=>{var e;null===(e=m.current)||void 0===e||e.stopStream()},x=e=>{c(e)},p=()=>{f(),""!==t&&(x("loading"),i(l+1),s(t),a(""))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed w-3/4 bg-neutral-700 rounded-2xl overflow-hidden bottom-8 left-2/4 -translate-x-2/4 border border-neutral-400",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("input",{className:"w-full bg-transparent outline-none px-3 py-2 text-white",type:"text",onChange:e=>{a(e.currentTarget.value)},value:t,placeholder:"Enter your prompt...",onKeyDown:e=>{13===e.keyCode&&p()}})}),(0,r.jsx)("div",{className:"min-w-10 max-w-10 w-10",children:(0,r.jsx)("div",{className:"bg-neutral-400 text-black w-full h-full flex justify-center items-center cursor-pointer",onClick:p,children:(0,r.jsxs)("span",{className:"text-xl",children:["ready"===o&&(0,r.jsx)(d.yhK,{}),"loading"===o&&(0,r.jsx)("div",{className:"loader"}),"streaming"===o&&(0,r.jsx)(h.ZRu,{})]})})})]})}),(0,r.jsx)(u,{click:l,input:e,callBack:x,ref:m})]})}},895:function(){}},function(e){e.O(0,[239,706,240,442,971,23,744],function(){return e(e.s=3999)}),_N_E=e.O()}]);